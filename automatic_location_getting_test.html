<!DOCTYPE html>
<html>
  <head>
    <title>Google Maps API Example</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxGK0zOZL2VF3vaikld24WgCdGN5cDSNY"></script>
  </head>
  <body>
    <div id="map" style="height: 400px; width: 100%;"></div>
    <div id="eta" style="margin-top: 10px;"></div>
    <div>
      <button id="getUserLocation">Get My Location</button>
      <button id="setLocation">Set Location</button>
      <button id="setDestination">Set Destination Location</button>
      <label for="endLocation">End Location:</label>
      <input type="text" id="endLocation" placeholder="Enter destination address">
      <button id="calculateRoute">Calculate Route</button>
    </div>
    <script>
      var map, directionsService, directionsDisplay;
      var userLocation = null;
      var destinationLocation = null;
      var setLocationMode = false;
      var setDestinationMode = false;

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: 39.993330, lng: -75.243300 },
          zoom: 10,
        });

        // Create a DirectionsService
        directionsService = new google.maps.DirectionsService();

        // Create a DirectionsRenderer to display the route on the map
        directionsDisplay = new google.maps.DirectionsRenderer({ map: map });

        // Set up the event listeners
        document.getElementById("getUserLocation").addEventListener("click", getUserLocation);
        document.getElementById("setLocation").addEventListener("click", toggleSetLocationMode);
        document.getElementById("setDestination").addEventListener("click", toggleSetDestinationMode);
        document.getElementById("calculateRoute").addEventListener("click", calculateRoute);

        // Add click event listener to the map
        map.addListener('click', function(event) {
          if (setLocationMode) {
            userLocation = event.latLng;
            map.setCenter(userLocation);
            calculateRoute();
            toggleSetLocationMode();
          } else if (setDestinationMode) {
            destinationLocation = event.latLng;
            calculateRoute();
            toggleSetDestinationMode();
          }
        });
      }

      function getUserLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function (position) {
            var lat = position.coords.latitude;
            var lng = position.coords.longitude;
            userLocation = new google.maps.LatLng(lat, lng);
            map.setCenter(userLocation);
            calculateRoute(); // Reroute the trip
          });
        } else {
          alert("Geolocation is not supported by your browser.");
        }
      }

      function toggleSetLocationMode() {
        setLocationMode = !setLocationMode;
        if (setLocationMode) {
          document.getElementById("setLocation").innerHTML = "Click on Map to Set Location";
        } else {
          document.getElementById("setLocation").innerHTML = "Set Location";
        }
      }

      function toggleSetDestinationMode() {
        setDestinationMode = !setDestinationMode;
        if (setDestinationMode) {
          document.getElementById("setDestination").innerHTML = "Click on Map to Set Destination Location";
        } else {
          document.getElementById("setDestination").innerHTML = "Set Destination Location";
        }
      }

      function calculateRoute() {
        var endLocation = document.getElementById("endLocation").value;

        if (userLocation && (endLocation || destinationLocation)) {
          var request = {
            origin: userLocation, // Start from the user's location
            destination: endLocation || destinationLocation, // Use manually set destination or destination from the input field
            travelMode: "DRIVING",
          };

          directionsService.route(request, function (result, status) {
            if (status == "OK") {
              directionsDisplay.setDirections(result);
              var route = result.routes[0];
              var leg = route.legs[0];
              var eta = leg.duration.text;
              document.getElementById("eta").innerHTML = "ETA: " + eta;
            } else {
              document.getElementById("eta").innerHTML = "Could not calculate route. Please check the addresses.";
            }
          });
        } else {
          alert("Please set your location and either enter the destination address or set the destination location.");
        }
      }

      initMap();
    </script>
  </body>
</html>

